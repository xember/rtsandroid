// (c)2013 Prime Contact
// $HeadURL: svn://svn.prime-contact.com/rts/client/tags/2.04/res/rts.js $
// $Date: 2013-09-23 20:16:38 +0200 (Mon, 23 Sep 2013) $

if(typeof(jQuery)=='undefined'){alert("ERROR: jQuery library not loaded!");}
if(typeof(jws)=='undefined'){alert("ERROR: jWebSocket library not loaded!");}
(function($){$.fn.animateHighlight=function(highlightColor,duration){var highlightBg=highlightColor||"#FFFF9C";var animateMs=duration||1000;var originalBg=this.css("background-color");if(!originalBg||originalBg==highlightBg){originalBg="#FFFFFF";}
if(typeof($.ui)=='undefined'||($.browser.msie&&$.browser.version.substring(0,$.browser.version.indexOf('.'))<8)){$(this).css("backgroundColor",highlightBg).animate({opacity:'+=0'},1000,function(e){$(this).css("backgroundColor",originalBg)});}else{$(this).css("backgroundColor",highlightBg).animate({backgroundColor:originalBg},animateMs,null,function(){$(this).css("backgroundColor",originalBg);});}}})(jQuery);Date.prototype.getWeekNr=function(){var dt=new Date(this.getTime());var d=dt.getDay();if(d==0)d=7;dt.setTime(dt.getTime()+(4-d)*86400000);var n=Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);return Math.floor(n/7)+1;}
Date.prototype.format=function(sFormat){var lz=function(s){return String(100+Number(s)).substring(1);}
var t=sFormat;t=t.replace(/%Y/g,this.getFullYear());t=t.replace(/%m/g,lz(this.getMonth()+1));t=t.replace(/%M/g,this.toString().replace(/^[A-z]+ ([A-z]+) .*/,"$1"));t=t.replace(/%n/g,this.getMonth()+1);t=t.replace(/%d/g,lz(this.getDate()));t=t.replace(/%D/g,this.toString().replace(/^([A-z]+) .*/,"$1"));t=t.replace(/%l/g,this.toLocaleString().replace(/^([A-z]+) .*/,"$1"));t=t.replace(/%j/g,this.getDate());t=t.replace(/%w/g,this.getDay());t=t.replace(/%W/g,this.getWeekNr());t=t.replace(/%H/g,lz(this.getHours()));t=t.replace(/%G/g,this.getHours());t=t.replace(/%i/g,lz(this.getMinutes()));t=t.replace(/%s/g,lz(this.getSeconds()));return t;};Date.prototype.time=function(){return Math.floor(this.getTime()/1000);}
var rts={jwsIdx:[0],jwsURLs:[["ws://localhost:8787/jWebSocket/jWebSocket"]],jwsUsername:"root",jwsPassword:"root",jwsClient:[null],jwsConnTimestamp:[0],jwsStatus:[],fallbackURLs:null,bFallback:false,sFallbackID:null,iInterval:1000*3,iActionTimeoutID:null,bAdmin:false,sMode:null,sObject:null,bDebug:false,sUsername:null,sPassword:null,iReconnectTimeout:9,idLogonHide:"#idLogon",idLogonShow:"#idStats",idMsgWrapper:"#rtsMsgWrapper",idStatus:"#rtsStatus",idDebugLog:"#rtsDebugLog",idActiveMsgTable:"#rtsActiveMessages",MSG_RTS_CONNECTION_LOST:"The connection to the WebSocket server is lost. Will try to reconnect every few seconds.<br>If the problem persists please contact your system administrator.",MSG_RTS_PARALLEL_UNSUPPORTED:"Using parallel connections in FlashBridge mode is not reliable. Please use a modern browser.",MSG_RTS_NO_FALLBACK:"Websockets disabled, but no fallback given...",MSG_RTS_WRAPPER_ERR_GETDATA:"RTS Wrapper getdata returned an error",MSG_RTS_WRAPPER_NOSTATS:"RTS Wrapper returned invalid JSON ('stats' is not present or not an object)..",MSG_RTS_WRAPPER_UNEXPECTED:"Unexpected response from RTS Wrapper (Not JSON)",MSG_RTS_WRAPPER_ERR_LOGIN:"RTS Wrapper logon returned an error",MSG_RTS_AJAX_OFFLINE:"You are offline!! Please Check Your Network.",MSG_RTS_AJAX_404:"RTS Wrapper request returned a 404 Error page not found.",MSG_RTS_AJAX_500:"RTS Wrapper returned an Internal Server Error 500.",MSG_RTS_AJAX_ERR_PARSE:"RTS Wrapper response could not be parsed as JSON.",MSG_RTS_AJAX_TIMEOUT:"RTS Wrapper request timed out.",MSG_RTS_AJAX_UNKNOWN_ERR:"An unknown error occurred",MSG_RTS_UNKNOWN_MODE:"rts.object - Unknown mode was given. Mode must be either 'site' or 'agent'",MSG_RTS_ADMIN_TERMINATE:"The system will be stopped",TXT_RTS_SELECT:"Please select...",TXT_RTS_NO_MSG_ON_CONNECTION:"There are no active messages on connection",VERSION:"$HeadURL: svn://svn.prime-contact.com/rts/client/tags/2.04/res/rts.js $".replace(/.*\/(trunk|[^\/]+)\/res\/.*/,"$1"),NAME:"RTS Web Client",init:function(){if(this.getUrlParam("debug")=="true"){this.bDebug=true;$(this.idStatus).show();$(this.idDebugLog).show();}
if(this.sMode==null){var sTmpObject=this.getUrlParam("site");if((sTmpObject!=null)&&(sTmpObject!="")){this.sMode="site";this.sObject=sTmpObject;}else{this.sMode="agent";this.sObject=this.getUrlParam("agent");}}
this.log("[init] RTS Client version "+this.VERSION);var oStats={}
$.each($('span,div'),function(i){if($(this).data('stat')){var aStats=$(this).data('stat').split(' ');for(var i=0;i<aStats.length;i++){oStats[aStats[i]]=null;}}});$('body').data('stats',oStats);oStats=null;if(jws.browserSupportsWebSockets()&&this.jwsIdx!=null){for(var i=0;i<rts.jwsIdx.length;i++){this.log("[init] Creating new "+(jws.browserSupportsNativeWebSockets?"(Native)":"(FlashBridge)")+" jWebSocket connection:"+i);this.jwsClient[i]=new jws.jWebSocketJSONClient();this.log("[init] Connecting to "+this.jwsURLs[i][this.jwsIdx[i]]);this.jwsClient[i].logon(this.jwsURLs[i][this.jwsIdx[i]],this.jwsUsername,this.jwsPassword,{OnOpen:rts.jwsOpen,OnWelcome:rts.jwsWelcome,OnMessage:rts.jwsMessage,OnGoodBye:rts.jwsGoodBye,OnClose:rts.jwsClose});this.jwsConnTimestamp[i]=(new Date()).time();$(rts.idStatus).append('<div class="'+i+'">['+i+'] Disconnected</div>');}}else{if(this.jwsIdx!=null&&this.fallbackURLs==null){rts.msgError("CLI0001",jws.MSG_WS_NOT_SUPPORTED);}else{if(this.fallbackURLs){$(this.idStatus).empty().append('<div class="connected">Fallback mode</div>');this.bFallback=true;var ajaxToken=null;if(this.sMode=="site"&&this.sUsername){this.log("[init] Requesting fallback logon for user "+this.sUsername+" ...");ajaxToken={username:this.sUsername,password:this.sPassword,mode:this.sMode,object:this.sObject};}
if(this.sMode=="site"&&!this.sUsername){this.log("[init] Requesting anonymous fallback logon ....");ajaxToken={mode:this.sMode,object:this.sObject};}
if(ajaxToken){$.post(this.fallbackURLs.logon,ajaxToken,function(data){var o=jQuery.parseJSON(data);if(o.result=="OK"){rts.log("[init/callback] Logon response is OK");rts.sFallbackID=o.wsid;$(rts.idLogonHide).hide();$(rts.idLogonShow).show();$(rts.idStatus+' div').attr("class","authenticated");$(rts.idStatus+' div').text("Client: "+rts.sFallbackID+" (fallback mode)");window.setTimeout(rts.poll,1000);return true;}else{rts.msgError("CLI0006",rts.MSG_RTS_WRAPPER_ERR_LOGIN+'<br>'+o.reason);}});}}else{this.msgError("CLI0016",this.MSG_RTS_NO_FALLBACK);}}}
setInterval(rts.system,1000);},jws:function(jwsURL){if(jwsURL){for(var i=0;i<arguments.length;i++){this.jwsClient[i]=null;this.jwsConnTimestamp[i]=0;if(typeof(arguments[i])==="string"){this.jwsIdx[i]=0;this.jwsURLs[i]=[arguments[i]];}else{this.jwsIdx[i]=Math.floor(Math.random()*arguments[i].length);this.jwsURLs[i]=[];for(var j=0;j<arguments[i].length;j++){this.jwsURLs[i][j]=arguments[i][j];}}}}else{this.jwsIdx=null;}},object:function(sMode,sObject){if(sMode=="site"||sMode=="agent"){this.sMode=sMode;}else{alert(rts.MSG_RTS_UNKNOWN_MODE);}
this.sObject=sObject;},fallback:function(logonURL,getdataURL,logoffURL,interval){this.fallbackURLs={"logon":logonURL,"getdata":getdataURL,"logoff":logoffURL}
if(typeof(interval)=="number"&&parseInt(interval,10)>0){this.iInterval=1000*parseInt(interval,10);}
$.ajaxSetup({cache:false,error:function(x,e){if(x.status==0){rts.msgError("CLI0010",rts.MSG_RTS_AJAX_OFFLINE);}else if(x.status==404){rts.msgError("CLI0011",rts.MSG_RTS_AJAX_404);}else if(x.status==500){rts.msgError("CLI0012",rts.MSG_RTS_AJAX_500);}else if(e=='parsererror'){rts.msgError("CLI0013",rts.MSG_RTS_AJAX_ERR_PARSE);}else if(e=='timeout'){rts.msgError("CLI0014",rts.MSG_RTS_AJAX_TIMEOUT);}else{rts.msgError("CLI0015",rts.MSG_RTS_AJAX_UNKNOWN_ERR+'<br>'+x.responseText);}
window.setTimeout(rts.poll,rts.iReconnectTimeout);}});},logon:function(sUsername,sPassword){rts.sUsername=sUsername||rts.sUsername;rts.sPassword=sPassword||rts.sPassword;$(rts.idMsgWrapper+" div.system").remove();$(rts.idMsgWrapper+" div.warning").remove();if(rts.jwsIdx!=null){for(var i=0;i<rts.jwsIdx.length;i++){var sId=rts.jwsClient[i].getId();rts.jwsLogon(sId);}}},exit:function(){if(rts.jwsIdx!=null){for(var i=0;i<rts.jwsIdx.length;i++){rts.log("[exit] Closing websocket:"+i+" connection...");rts.jwsClient[i].close();}}
if(rts.bFallback){$.post(rts.fallbackURLs.logoff,{wsid:rts.sFallbackID});}},poll:function(){$.get(rts.fallbackURLs.getdata,{wsid:rts.sFallbackID},function(data){$(rts.idMsgWrapper+" div.warning").remove();$(rts.idMsgWrapper+" div.error").remove();if(data&&data.substr(0,1)=="{"){var o=jQuery.parseJSON(data);if(o.result=="OK"){if(typeof(o.stats)=="object"){var sLogLine="getdata stats: ";for(var s in o.stats){$('body').data('stats')[s]=o.stats[s];sLogLine=sLogLine+s+"="+o.stats[s]+"; ";}
rts.log("[poll] "+sLogLine);if(typeof(o.message)=="object"&&typeof(o.message['category'])=="string"){rts.log("[poll] getdata message: "+o.message['category']+"; line1="+o.message['line1']+"; line2="+o.message['line2']);rts.message(o.message['category'],o.message['line1'],o.message['line2'])}else{rts.log("[poll] getdata message is empty; clearing message");rts.message('clear');}
window.setTimeout(rts.action,100);}else{rts.msgError("CLI0004",rts.MSG_RTS_WRAPPER_NOSTATS);}}else{rts.msgError("CLI0003",rts.MSG_RTS_WRAPPER_ERR_GETDATA+'<br>'+o.reason);}}else{rts.msgError("CLI0007",rts.MSG_RTS_WRAPPER_UNEXPECTED);}
window.setTimeout(rts.poll,rts.iInterval);});},system:function(){$.each($('span,div'),function(i){if($(this).data('system')=="datetime"){var oDate=new Date();if($(this).data('format')){$(this).text(oDate.format($(this).data('format')));}else{$(this).text(oDate.toLocaleDateString());}
return true;}
if($(this).data('system')=="mode"){$(this).text(rts.sMode);return true;}
if($(this).data('system')=="object"){$(this).text(rts.sObject);return true;}});if(jws.browserSupportsWebSockets()&&rts.jwsIdx!=null){for(var i=0;i<rts.jwsIdx.length;i++){var sId=rts.jwsClient[i].getId();if(rts.jwsClient[i].isConnected()){$(rts.idStatus+' div.'+i).attr("class",i+" "+rts.jwsStatus[i]);$(rts.idStatus+' div.'+i).text('['+i+'] '+sId+(jws.browserSupportsNativeWebSockets?" (Native) ":" (FlashBridge) "));if(jws.browserSupportsNativeWebSockets&&typeof(rts.jwsStatus[i])=="string"&&(rts.jwsStatus[i]!="authenticated"&&rts.sMode=="site")&&(rts.jwsConnTimestamp[i]+rts.iReconnectTimeout)<(new Date()).time()){rts.log("[system] User-type logon-token was not received within the re-connect timeout; reconnect forced","red");rts.reconnect(i);}}else{rts.jwsStatus[i]=null;$(rts.idStatus+' div.'+i).attr("class",i+" disconnected");$(rts.idStatus+' div.'+i).text('['+i+'] Disconnected');if((rts.jwsConnTimestamp[i]+rts.iReconnectTimeout)<(new Date()).time()){rts.reconnect(i);}}}}},action:function(){rts.log("[action] Collected statistics will be parsed by client");rts.iActionTimeoutID=null;var oStats=$('body').data('stats');$.each($('span,div'),function(i){if($(this).data('function')){var sFunction=$(this).data('function');var aArgs=[];if($(this).data('stat')){var aStats=$(this).data('stat').split(' ');var aLabels=$(this).data('labels')?$(this).data('labels').split(' '):[];for(var i=0;i<aStats.length;i++){if(oStats[aStats[i]]!==null&&oStats[aStats[i]]!==""){if(typeof(aLabels[i])!=='undefined'){aArgs.push([aLabels[i],oStats[aStats[i]]]);}else{aArgs.push([oStats[aStats[i]]]);}}}}
if(typeof(window[sFunction])==="undefined"){rts.log("[action] Function '"+sFunction+"' is missing!","red");}else{var mResult=window[sFunction](aArgs);if(typeof(mResult)!=="undefined"){$(this).html(mResult);}}
return true;}
if($(this).data('stat')){var aStats=$(this).data('stat').split(' ');for(var i=0;i<aStats.length;i++){if(typeof(oStats[aStats[i]])!=="undefined"&&oStats[aStats[i]]!=null){var sValue=oStats[aStats[i]];if($(this).data('bling')&&$(this).data('bling').indexOf('gt')!=-1){if(sValue>$(this).text()){$(this).animateHighlight();}}
if($(this).data('bling')&&$(this).data('bling').indexOf('lt')!=-1){if(sValue<$(this).text()){$(this).animateHighlight();}}
switch($(this).data('format')){case'time':$(this).text(rts.convertToTime(sValue));break;case'round':$(this).text(Math.round(sValue));break;default:$(this).text(sValue);}}}
return true;}});},convertToTime:function(s){var d=Number(s);var h=Math.floor(d/3600);var m=Math.floor(d%3600/60);var s=Math.floor(d%3600%60);if(d>0){return((h>0)?h+":":"")+m+":"+((s<10)?"0":"")+s;}else{return"0:00";}},getUrlParam:function(aString){aString=aString.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regexS="[\\?&]"+aString+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(window.location.href);if(results==null)return"";else return results[1];},htmlentities:function(s){s=String(s).replace(/[^\x20-\x7A\x7C\x7E\xA1-\xFF]/g,'');return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');},message:function(sCategory,sLine1,sLine2){if(sCategory=="clear"||sCategory=="info"||sCategory=="alarm"||sCategory=="system"){$(rts.idMsgWrapper+" div.info").remove();$(rts.idMsgWrapper+" div.alarm").remove();$(rts.idMsgWrapper+" div.system").remove();}
if(sCategory=="info"||sCategory=="alarm"||sCategory=="system"){if(sLine2==null){$(rts.idMsgWrapper).append('<div class="'+sCategory+'"><p>'+sLine1+'</p></div>');}else{$(rts.idMsgWrapper).append('<div class="'+sCategory+'"><h1>'+sLine1+'</h1><p>'+sLine2+'</p></div>');}}else if(sCategory!="clear"){this.log("[message] MESSAGE with unknown category: "+sCategory,"red");}},msgWarning:function(sCode,sMessage){$(rts.idMsgWrapper+" div.warning").remove();$(rts.idMsgWrapper).append('<div class="warning"><h1>'+sCode+'</h1><p>'+sMessage+'</p></div>');this.log("[msgWarning] WARNING "+sCode+": "+sMessage,"orange");},msgError:function(sCode,sMessage){$(rts.idMsgWrapper+" div.error").remove();$(rts.idMsgWrapper).append('<div class="error"><h1>'+sCode+'</h1><p>'+sMessage+'</p></div>');this.log("[msgError] ERROR "+sCode+": "+sMessage,"red");},log:function(string,color){if(this.bDebug){var lz=function(n){return n<10?'0'+n:n}
color=(typeof color==='undefined')?'#000':color;if($(rts.idDebugLog+" p").length>100){$(rts.idDebugLog).empty();}
var d=new Date();var ts=lz(d.getHours())+":"+lz(d.getMinutes())+":"+lz(d.getSeconds())+"."+lz(d.getMilliseconds());$(rts.idDebugLog).append('<p style="color:'+color+'">'+ts+' '+string+"</p>");$(rts.idDebugLog).scrollTop($(rts.idDebugLog)[0].scrollHeight);}},reconnect:function(idx){$(rts.idMsgWrapper+" div.system").remove();for(var i=0;i<rts.jwsIdx.length;i++){if(typeof(i)!=="number"||i==idx){rts.log("[reconnect] Closing websocket:"+i+" connection...");rts.jwsClient[i].close();if(rts.jwsIdx[i]+1<rts.jwsURLs[i].length){rts.jwsIdx[i]++;}else{rts.jwsIdx[i]=0;}
rts.log("[reconnect] Connecting to "+rts.jwsURLs[i][rts.jwsIdx[i]]);rts.jwsClient[i].logon(rts.jwsURLs[i][rts.jwsIdx[i]],rts.jwsUsername,rts.jwsPassword,{OnOpen:rts.jwsOpen,OnWelcome:rts.jwsWelcome,OnMessage:rts.jwsMessage,OnGoodBye:rts.jwsGoodBye,OnClose:rts.jwsClose});rts.jwsConnTimestamp[i]=(new Date()).time();}}},timeouts:function(iConnectTimeout,iReconnectTimeout){if(iConnectTimeout>0){this.iReconnectTimeout=iConnectTimeout;}
if(iReconnectTimeout>0){this.iReconnectTimeout=iReconnectTimeout;}
rts.log("[timeouts] This function is deprecated.. use 'timeout' instead..");},timeout:function(iReconnectTimeout){if(iReconnectTimeout>0){this.iReconnectTimeout=iReconnectTimeout;}},getConnectionById:function(sId){for(var i=0;i<rts.jwsIdx.length;i++){if(sId==rts.jwsClient[i].getId()){return i;}}
return null;},getIdByURL:function(sURL){for(var i=0;i<rts.jwsIdx.length;i++){if(sURL==rts.jwsClient[i].getURL()){return rts.jwsClient[i].getId()}}
return null;},jwsLogon:function(sId){$(rts.idMsgWrapper+" div.system").remove();$(rts.idMsgWrapper+" div.warning").remove();$(rts.idMsgWrapper+" div.error").remove();var jwsToken={type:"user",subtype:"logon",role:null,clientversion:rts.VERSION,clientname:rts.NAME};if(rts.bAdmin&&rts.sUsername){rts.log("[jwsLogon] Requesting admin websocket ("+sId+") logon for user "+rts.sUsername+" ...");jwsToken.role="admin";jwsToken.username=rts.sUsername;jwsToken.password=rts.sPassword;}else{if(rts.sMode=="agent"&&rts.sUsername){rts.sObject=rts.sObject||rts.sUsername;rts.log("[jwsLogon] Requesting websocket ("+sId+") logon for user "+rts.sUsername+" ...");jwsToken.role="normal";jwsToken.mode="agent";jwsToken.object=rts.sObject;jwsToken.username=rts.sUsername;jwsToken.password=rts.sPassword;}
if(rts.sMode=="site"&&rts.sUsername){rts.log("[jwsLogon] Requesting websocket ("+sId+") logon for user "+rts.sUsername+" ...");jwsToken.role="normal";jwsToken.mode="site";jwsToken.object=rts.sObject;jwsToken.username=rts.sUsername;jwsToken.password=rts.sPassword;}
if(rts.sMode=="site"&&!rts.sUsername){rts.log("[jwsLogon] Requesting anonymous websocket ("+sId+") logon ...");jwsToken.role="normal";jwsToken.mode="site";jwsToken.object=rts.sObject;}}
if(jwsToken.role){for(var i=0;i<rts.jwsIdx.length;i++){if(sId==rts.jwsClient[i].getId()){rts.jwsClient[i].sendToken(jwsToken,{OnResponse:""});}}}},jwsOpen:function(oEvent){rts.log("[jwsOpen] Received 'open' token");},jwsWelcome:function(oEvent){var sId=oEvent.sourceId;rts.log("[jwsWelcome] Received 'welcome' token for client:"+sId);rts.jwsStatus[rts.getConnectionById(sId)]="connected";rts.jwsLogon(sId);},jwsGoodBye:function(oEvent){rts.log("[jwsGoodBye] Received 'goodbye' token");},jwsClose:function(oEvent){rts.msgError("CLI0002",rts.MSG_RTS_CONNECTION_LOST);},jwsMessage:function(oEvent,oToken){rts.log("[jwsMessage] Received 'message' token: "+oEvent.data);if(oToken.type=="user"&&oToken.subtype){switch(oToken.subtype){case"logon":if(oToken.result=="true"){var sId=null;if(typeof(oToken.websocketid)!=='undefined'){sId=oToken.websocketid;rts.jwsStatus[rts.getConnectionById(sId)]="authenticated";}else if(jws.browserSupportsNativeWebSockets&&typeof(oEvent.target)=="object"){sId=rts.getIdByURL(oEvent.target.url);rts.jwsStatus[rts.getConnectionById(sId)]="authenticated";}else{rts.log('[jwsMessage/logon] Cannot determine from which connection this conformation was received!','red');if(rts.jwsIdx.length==1){rts.jwsStatus[0]="authenticated";}else{rts.msgError("CLI0009",rts.MSG_RTS_PARALLEL_UNSUPPORTED);}}
$(rts.idLogonHide).hide();$(rts.idLogonShow).show();if(rts.bAdmin){rts.requestInfo('displays',sId);}else{rts.iActionTimeoutID=window.setTimeout(rts.action,100);}}
break;case"statupdate":$('body').data('stats')[oToken.statid]=oToken.value;if(!rts.iActionTimeoutID){rts.iActionTimeoutID=window.setTimeout(rts.action,100);}
break;case"message":if(rts.bAdmin){}else{rts.message(oToken.category,oToken.line1,oToken.line2);}
break;case"warning":rts.msgWarning(oToken.code,oToken.text);break;case"error":rts.msgError(oToken.code,oToken.text);break;case"info":var sId=null;if(typeof(oToken.websocketid)!=='undefined'){sId=oToken.websocketid;rts.msgInfo(oToken.request,oToken.response,rts.getConnectionById(sId));}else if(jws.browserSupportsNativeWebSockets&&typeof(oEvent.target)=="object"){sId=rts.getIdByURL(oEvent.target.url);rts.msgInfo(oToken.request,oToken.response,rts.getConnectionById(sId));}else{for(var i=0;i<rts.jwsIdx.length;i++){rts.msgInfo(oToken.request,oToken.response,i);}}
break;default:rts.log("[jwsMessage] Unknown subtype in user type token message: "+oToken.subtype,"red");}}}}
$(document).ready(function(){if(!$(rts.idMsgWrapper).length){$("body").append('<div id="'+rts.idMsgWrapper.substr(1)+'"></div>');}
if(!$(rts.idStatus).length){$("body").append('<div id="'+rts.idStatus.substr(1)+'"></div>');}
if(!$(rts.idDebugLog).length){$("body").append('<div id="'+rts.idDebugLog.substr(1)+'"></div>');}
rts.init();});$(window).unload(rts.exit);